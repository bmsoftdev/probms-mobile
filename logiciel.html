<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>Ø²Ø¨Ø§Ø¦Ù† Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800&display=swap" rel="stylesheet">

<style>
:root{
  --bg1:#070517;
  --bg2:#120a2a;
  --stroke:rgba(255,255,255,.08);
  --text:#f1f5f9;
  --muted:rgba(241,245,249,.7);
  --mauve:#b55cff;
  --mauve2:#7c3aed;
  --shadow:0 25px 60px rgba(0,0,0,.5);
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:'Cairo',Tahoma;
  background:
    radial-gradient(900px 500px at 15% 10%, rgba(181,92,255,.25), transparent 60%),
    linear-gradient(135deg,var(--bg1),var(--bg2));
  color:var(--text);
}
.container{max-width:1100px;margin:30px auto;padding:20px}
.header{
  background:linear-gradient(135deg, rgba(181,92,255,.18), rgba(14,10,31,.7));
  border:1px solid var(--stroke);
  border-radius:18px;
  padding:18px;
  box-shadow:var(--shadow);
  display:flex;justify-content:space-between;align-items:center;
}
.back{
  background:linear-gradient(135deg,var(--mauve),var(--mauve2));
  border:none;color:white;padding:10px 16px;
  border-radius:14px;font-weight:800;cursor:pointer;
}
.search-box{margin-top:18px}
.search-box input{
  width:100%;padding:12px 14px;border-radius:14px;
  border:1px solid var(--stroke);
  background:rgba(14,10,31,.7);color:white;
}
.stats{
  margin-top:20px;display:grid;
  grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
  gap:15px;
}
.stat{
  background:rgba(14,10,31,.7);
  border:1px solid var(--stroke);
  border-radius:16px;padding:16px;
}
.stat span{font-size:13px;color:var(--muted)}
.stat strong{font-size:22px;color:var(--mauve)}
.table-card{
  margin-top:25px;background:rgba(14,10,31,.7);
  border:1px solid var(--stroke);
  border-radius:18px;overflow:hidden;
}
table{width:100%;border-collapse:collapse}
th,td{padding:12px;border-bottom:1px solid #1f2937;text-align:center}
th{background:#020617}
.top-debt{background:linear-gradient(135deg,#7f1d1d,#b91c1c)}
.top-debt td{color:#fff;font-weight:800}
.normal-row{background:rgba(14,10,31,.6)}
.loading,.error,.empty{text-align:center;padding:30px}
.error{color:#f87171}.empty{color:#facc15}
footer{text-align:center;margin-top:25px;font-size:12px;opacity:.6}
</style>
</head>

<body>

<div class="container">

  <div class="header">
    <h1>ğŸ“‰ Ø²Ø¨Ø§Ø¦Ù† Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬</h1>
    <button class="back" onclick="location.href='index.html'">â¬… Ø§Ù„Ø±Ø¬ÙˆØ¹</button>
  </div>

  <div class="search-box">
    <input type="text" id="searchInput" placeholder="ğŸ” Ø§Ø¨Ø­Ø« Ø¨Ø§Ø³Ù… Ø§Ù„Ø²Ø¨ÙˆÙ† Ø£Ùˆ Ø§Ù„Ù‡Ø§ØªÙ">
  </div>

  <div class="stats">
    <div class="stat">
      <span> Ø¹Ø¯Ø¯ Ø§Ù„Ø²Ø¨Ø§Ø¦Ù† </span>
      <strong id="nbClients">â€”</strong>
    </div>
    <div class="stat">
      <span>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¯ÙŠÙˆÙ†</span>
      <strong id="totalDebt">â€”</strong>
    </div>
  </div>

  <div id="loading" class="loading">â³ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¯ÙŠÙˆÙ†...</div>
  <div id="error" class="error" style="display:none"></div>
  <div id="empty" class="empty" style="display:none">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬</div>

  <div class="table-card">
    <table id="creditsTable" style="display:none">
      <thead>
        <tr>
          <th>Ø§Ù„Ø²Ø¨ÙˆÙ†</th>
          <th>Ø§Ù„Ù‡Ø§ØªÙ</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

</div>

<footer>
ProBMS Â© www.bmsoftdev.com
</footer>

<script>









 const CREDIT_URL = "https://script.google.com/macros/s/AKfycbxzNSBOg_28KA0XBN_reeEnNIRtB5KHP3bU2gMlF9t0qeLAGqs1_aS6ZdfvkJlciMUw/exec?action=logiciel";





let allClients = [];

function num(v){ return Number(v)||0; }

function render(list){
  const tbody = document.querySelector("#creditsTable tbody");
  tbody.innerHTML = "";

  document.getElementById("empty").style.display =
    list.length ? "none" : "block";

  list.forEach((c,i)=>{
    const name  = c.client  ?? "";
    const phone = c.mobile  ?? "";
    const solde = num(c.solde);

    const tr = document.createElement("tr");
    tr.className = i < 3 ? "top-debt" : "normal-row";

    tr.innerHTML = `
      <td style="text-align:right">
        ${name}
        <div style="font-size:13px">ğŸ’° ${solde.toLocaleString('fr-FR')} Ø¯Ø¬</div>
      </td>
      <td>${phone}</td>
    `;
    tbody.appendChild(tr);
  });

  document.getElementById("creditsTable").style.display = "table";
}

fetch(CREDIT_URL)
.then(r => r.json())
.then(data => {
  document.getElementById("loading").style.display = "none";

  const items = Array.isArray(data.items) ? data.items : [];
  items.sort((a,b)=>num(b.solde)-num(a.solde));

  allClients = items;

  document.getElementById("nbClients").innerText =
    data.clients ?? items.length;

  const total =
    data.totalDebt ??
    items.reduce((s,c)=>s+num(c.solde),0);

  document.getElementById("totalDebt").innerText =
    total.toLocaleString('fr-FR') + " Ø¯Ø¬";

  render(items);
})
.catch(err=>{
  document.getElementById("loading").style.display="none";
  document.getElementById("error").style.display="block";
  document.getElementById("error").innerText="âŒ ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª";
  console.error(err);
});

document.getElementById("searchInput").addEventListener("input",e=>{
  const q = e.target.value.toLowerCase();
  render(allClients.filter(c =>
    (c.client ?? "").toLowerCase().includes(q) ||
    (c.mobile ?? "").toLowerCase().includes(q)
  ));
});
</script>

</body>
</html>
