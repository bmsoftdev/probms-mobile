<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>ØªØ³Ø¯ÙŠØ¯Ø§Øª Ø§Ù„ÙŠÙˆÙ…</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800&display=swap" rel="stylesheet">

<style>
:root{
  --bg1:#070517;
  --bg2:#120a2a;
  --card:#0e0a1f;
  --stroke:rgba(255,255,255,.08);
  --text:#f1f5f9;
  --muted:rgba(241,245,249,.7);
  --mauve:#b55cff;
  --mauve2:#7c3aed;
  --good:#22c55e;
  --shadow:0 25px 60px rgba(0,0,0,.55);
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:'Cairo',Tahoma;
  background:
    radial-gradient(900px 500px at 15% 10%, rgba(181,92,255,.25), transparent 60%),
    linear-gradient(135deg,var(--bg1),var(--bg2));
  color:var(--text);
  min-height:100vh;
}
.container{
  max-width:1100px;
  margin:30px auto;
  padding:20px;
}
.header{
  background:linear-gradient(135deg, rgba(181,92,255,.18), rgba(14,10,31,.7));
  border:1px solid var(--stroke);
  border-radius:18px;
  padding:18px;
  box-shadow:var(--shadow);
  display:flex;
  justify-content:space-between;
  align-items:center;
}
.header h1{margin:0;font-size:22px;font-weight:800}
.back{
  background:linear-gradient(135deg,var(--mauve),var(--mauve2));
  border:none;color:white;
  padding:10px 16px;
  border-radius:14px;
  font-weight:800;
  cursor:pointer;
}
.stats{
  margin-top:20px;
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
  gap:15px;
}
.stat{
  background:rgba(14,10,31,.7);
  border:1px solid var(--stroke);
  border-radius:16px;
  padding:16px;
  box-shadow:var(--shadow);
}
.stat span{font-size:13px;color:var(--muted)}
.stat strong{font-size:22px;font-weight:900;color:var(--good)}
.search{margin-top:20px}
.search input{
  width:100%;
  padding:12px 14px;
  border-radius:14px;
  border:1px solid var(--stroke);
  background:rgba(255,255,255,.05);
  color:white;
  font-family:'Cairo';
}
.table-card{
  margin-top:20px;
  background:rgba(14,10,31,.7);
  border:1px solid var(--stroke);
  border-radius:18px;
  overflow:hidden;
  box-shadow:var(--shadow);
}
table{width:100%;border-collapse:collapse;font-size:14px}
th,td{
  padding:12px;
  border-bottom:1px solid #1f2937;
  text-align:center;
}
th{background:#020617;font-weight:800}
tr:hover{background:rgba(181,92,255,.08)}
.loading,.error{text-align:center;padding:30px}
.error{color:#f87171}
footer{
  margin-top:25px;
  text-align:center;
  font-size:12px;
  opacity:.6;
}
</style>
</head>

<body>

<div class="container">

  <div class="header">
    <h1>ğŸ’µ ØªØ³Ø¯ÙŠØ¯Ø§Øª Ø§Ù„ÙŠÙˆÙ…</h1>
    <button class="back" onclick="location.href='index.html'">â¬… Ø§Ù„Ø±Ø¬ÙˆØ¹</button>
  </div>

  <!-- ===== STATS ===== -->
  <div class="stats">
    <div class="stat">
      <span>Ø¹Ø¯Ø¯ ØªØ³Ø¯ÙŠØ¯Ø§Øª Ø§Ù„ÙŠÙˆÙ…</span>
      <strong id="nbVersement">0</strong>
    </div>
    <div class="stat">
      <span>Ù…Ø¬Ù…ÙˆØ¹ ØªØ³Ø¯ÙŠØ¯Ø§Øª Ø§Ù„ÙŠÙˆÙ…</span>
      <strong id="totalVersement">0 Ø¯Ø¬</strong>
    </div>
    <div class="stat">
      <span>Ù…Ø¬Ù…ÙˆØ¹ ØªØ³Ø¯ÙŠØ¯Ø§Øª Ø§Ù„Ø´Ù‡Ø±</span>
      <strong id="totalVersementMois">0 Ø¯Ø¬</strong>
    </div>
    <div class="stat">
      <span>Ù…Ø¬Ù…ÙˆØ¹ Ø£Ø±ØµØ¯Ø© Ø§Ù„Ø²Ø¨Ø§Ø¦Ù†</span>
      <strong id="totalSoldeClients">0 Ø¯Ø¬</strong>
    </div>
  </div>

  <div class="search">
    <input type="text" id="searchInput" placeholder="ğŸ” Ø¨Ø­Ø« Ø¨Ø§Ù„Ø²Ø¨ÙˆÙ† Ø£Ùˆ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©">
  </div>

  <div id="loading" class="loading">â³ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</div>
  <div id="error" class="error" style="display:none"></div>

  <div class="table-card">
    <table id="versementTable" style="display:none">
      <thead>
        <tr>
          <th>Ø§Ù„ÙˆÙ‚Øª</th>
          <th>Ø§Ù„Ø²Ø¨ÙˆÙ†</th>
          <th>Ø§Ù„Ù…Ø¨Ù„Øº (Ø¯Ø¬)</th>
          <th>Ù…Ù„Ø§Ø­Ø¸Ø©</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

</div>

<footer>
ProBMS Â© www.bmsoftdev.com â€” 06.62.54.14.86 / 07.76.07.77.94
</footer>

<script>
/* Ø±Ø§Ø¨Ø· JSON */
const VERSEMENT_URL =
"https://script.google.com/macros/s/AKfycbyFgZTvkdK2fQ2QOE7wgplpr-qCKdAgn9L8MaJ4jr7zGcHfnt6ekt-4rhjop853lNqa/exec?action=versement";

let allItems = [];

function format00(v){
  return Number(v || 0).toLocaleString('fr-FR',{minimumFractionDigits:2});
}

function renderTable(items){
  const tbody = document.querySelector("#versementTable tbody");
  tbody.innerHTML = "";
  items.forEach(v=>{
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${v.heure || ""}</td>
      <td style="text-align:right">${v.client || ""}</td>
      <td style="color:#22c55e;font-weight:800">${format00(v.montant)} </td>
      <td>${v.observation || ""}</td>
    `;
    tbody.appendChild(tr);
  });
}

fetch(VERSEMENT_URL)
  .then(r => r.json())
  .then(data => {

    document.getElementById("loading").style.display="none";

    const nbJour   = Number(data.nbVersements || 0);
    const totalJour = Number(data.totalVersements || 0);
    const totalMois = Number(data.totalVersementsMois || 0);
    const solde     = Number(data.totalSoldeClients || 0);

    document.getElementById("nbVersement").innerText = nbJour;
    document.getElementById("totalVersement").innerText = format00(totalJour)+" Ø¯Ø¬";
    document.getElementById("totalVersementMois").innerText = format00(totalMois)+" Ø¯Ø¬";
    document.getElementById("totalSoldeClients").innerText = format00(solde)+" Ø¯Ø¬";

    allItems = Array.isArray(data.items) ? data.items : [];
    renderTable(allItems);
    document.getElementById("versementTable").style.display="table";
  })
  .catch(err=>{
    document.getElementById("loading").style.display="none";
    document.getElementById("error").style.display="block";
    document.getElementById("error").innerText="âŒ ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ JSON";
    console.error(err);
  });

document.getElementById("searchInput").addEventListener("input",function(){
  const q=this.value.toLowerCase();
  renderTable(
    allItems.filter(v =>
      (v.client||"").toLowerCase().includes(q) ||
      (v.observation||"").toLowerCase().includes(q)
    )
  );
});
</script>

</body>
</html>
